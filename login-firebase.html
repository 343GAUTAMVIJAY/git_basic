<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login - Personal Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    .login-container{max-width:420px;margin:80px auto;padding:24px;border-radius:8px;background:#1f2a36;color:#fff}
    .login-input{width:100%;padding:10px;margin:8px 0;border-radius:4px;border:1px solid #ccc}
    .btn-primary{background:#64b5f6;color:#092032;padding:10px 16px;border:none;border-radius:4px;cursor:pointer;width:100%}
    .tab-switch{display:flex;margin-bottom:20px}
    .tab-btn{flex:1;padding:10px;background:#2c3e50;border:none;color:#fff;cursor:pointer}
    .tab-btn.active{background:#64b5f6;color:#092032}
  </style>
</head>
<body>
  <div class="login-container">
    <h2>Personal Dashboard</h2>
    <div class="tab-switch">
      <button class="tab-btn active" onclick="showLogin()">Sign In</button>
      <button class="tab-btn" onclick="showSignup()">Sign Up</button>
    </div>
    
    <form id="loginForm">
      <label>Email</label>
      <input id="email" class="login-input" type="email" required placeholder="you@example.com">
      <label>Password</label>
      <input id="password" class="login-input" type="password" required placeholder="password">
      <div style="margin-top:12px">
        <button class="btn-primary" type="submit" id="submitBtn">Sign in</button>
      </div>
      <p style="margin-top:12px;font-size:0.9rem;color:#ddd;text-align:center" id="statusText">Enter your credentials</p>
    </form>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
    import { getFirestore, doc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBv7sht1z_C674KFtkWJVcFZrNSIVDglmY",
      authDomain: "personal-dashboard-9b27f.firebaseapp.com",
      projectId: "personal-dashboard-9b27f",
      storageBucket: "personal-dashboard-9b27f.firebasestorage.app",
      messagingSenderId: "847796579655",
      appId: "1:847796579655:web:05005711f491f435c47062"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let isSignupMode = false;

    // Check if already logged in
    onAuthStateChanged(auth, (user) => {
      if (user) {
        window.location.replace('dashboard-firebase.html');
      }
    });

    window.showLogin = function() {
      isSignupMode = false;
      document.getElementById('submitBtn').textContent = 'Sign in';
      document.getElementById('statusText').textContent = 'Enter your credentials';
      document.querySelectorAll('.tab-btn')[0].classList.add('active');
      document.querySelectorAll('.tab-btn')[1].classList.remove('active');
    };

    window.showSignup = function() {
      isSignupMode = true;
      document.getElementById('submitBtn').textContent = 'Create Account';
      document.getElementById('statusText').textContent = 'Create a new account';
      document.querySelectorAll('.tab-btn')[0].classList.remove('active');
      document.querySelectorAll('.tab-btn')[1].classList.add('active');
    };

    const form = document.getElementById('loginForm');
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const pwd = document.getElementById('password').value;
      const statusText = document.getElementById('statusText');
      const submitBtn = document.getElementById('submitBtn');
      
      submitBtn.disabled = true;
      statusText.textContent = isSignupMode ? 'Creating account...' : 'Signing in...';
      statusText.style.color = '#64b5f6';

      try {
        if (isSignupMode) {
          // Create new account
          const userCredential = await createUserWithEmailAndPassword(auth, email, pwd);
          const user = userCredential.user;
          
          // Initialize user settings in Firestore
          await setDoc(doc(db, 'users', user.uid, 'settings', 'profile'), {
            dashboardName: 'Personal Dashboard',
            email: email,
            createdAt: new Date().toISOString()
          });
          
          statusText.textContent = 'Account created! Redirecting...';
          statusText.style.color = '#2ecc71';
          setTimeout(() => {
            window.location.replace('dashboard-firebase.html');
          }, 1000);
        } else {
          // Sign in existing user
          await signInWithEmailAndPassword(auth, email, pwd);
          statusText.textContent = 'Success! Redirecting...';
          statusText.style.color = '#2ecc71';
          setTimeout(() => {
            window.location.replace('dashboard-firebase.html');
          }, 1000);
        }
      } catch (error) {
        console.error('Authentication error:', error);
        let errorMessage = 'Authentication failed';
        
        if (error.code === 'auth/email-already-in-use') {
          errorMessage = 'Email already registered. Try signing in instead.';
        } else if (error.code === 'auth/invalid-email') {
          errorMessage = 'Invalid email address';
        } else if (error.code === 'auth/weak-password') {
          errorMessage = 'Password should be at least 6 characters';
        } else if (error.code === 'auth/user-not-found') {
          errorMessage = 'No account found. Try signing up instead.';
        } else if (error.code === 'auth/wrong-password') {
          errorMessage = 'Incorrect password';
        } else if (error.code === 'auth/invalid-credential') {
          errorMessage = 'Invalid credentials. Check email and password.';
        }
        
        statusText.textContent = errorMessage;
        statusText.style.color = '#e74c3c';
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
